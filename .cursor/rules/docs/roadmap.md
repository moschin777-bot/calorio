# Roadmap разработки REST API для сервиса подсчёта калорий

## Этап 1: Настройка проекта и базовая инфраструктура

- [x] Инициализация Django проекта
- [x] Настройка виртуального окружения
- [x] Установка зависимостей (Django, Django REST Framework, PostgreSQL, и др.)
- [x] Настройка settings.py (база данных, секретные ключи, CORS)
- [x] Создание структуры приложений (apps)
- [x] Настройка urls.py и базовой структуры API
- [x] Настройка логирования

## Этап 2: Модели данных

- [x] Создание модели User (расширение AbstractUser или использование кастомной модели)
- [x] Создание модели Profile (связь с User, дополнительные поля)
- [x] Создание модели Subscription (тарифы, статус подписки)
- [x] Создание модели Payment (история платежей)
- [x] Создание модели DailyGoal (цели КБЖУ на день)
- [x] Создание модели Meal (приём пищи: завтрак, обед, ужин, перекус)
- [x] Создание модели Dish (блюдо с КБЖУ)
- [x] Создание модели DishImage (фотографии блюд для распознавания)
- [x] Настройка связей между моделями (ForeignKey, ManyToMany)
- [x] Создание и применение миграций

## Этап 3: Система аутентификации и авторизации

- [x] Настройка JWT токенов (djangorestframework-simplejwt)
- [x] Создание сериализаторов для регистрации
- [x] Создание сериализаторов для входа (логин)
- [x] Создание ViewSet/APIView для регистрации
- [x] Создание ViewSet/APIView для входа
- [x] Создание ViewSet/APIView для обновления токена
- [x] Создание ViewSet/APIView для выхода
- [x] Настройка permissions для защищённых эндпоинтов
- [ ] Тестирование регистрации и входа

## Этап 4: Профиль пользователя

- [x] Создание сериализатора для Profile
- [x] Создание ViewSet для получения профиля
- [x] Создание ViewSet для обновления имени
- [x] Создание ViewSet для обновления email
- [x] Создание ViewSet для смены пароля
- [x] Валидация данных при обновлении
- [x] Обработка ошибок

## Этап 5: Управление целями КБЖУ

- [ ] Создание сериализатора для DailyGoal
- [ ] Создание ViewSet для получения целей на день
- [ ] Создание ViewSet для установки целей вручную
- [ ] Создание логики автоматического расчёта КБЖУ (формулы на основе возраста, веса, роста, активности)
- [ ] Создание ViewSet для автоматического расчёта целей
- [ ] Валидация входных данных для расчёта
- [ ] Сохранение истории изменений целей (опционально)

## Этап 6: Управление днями недели

- [ ] Создание сериализатора для работы с днями недели
- [ ] Создание ViewSet для получения данных по выбранному дню
- [ ] Логика фильтрации данных по дате/дню недели
- [ ] Обработка перехода между неделями

## Этап 7: Статистика КБЖУ за день

- [ ] Создание сериализатора для статистики
- [ ] Создание логики агрегации КБЖУ из всех блюд за день
- [ ] Расчёт процента выполнения целей
- [ ] Создание ViewSet для получения статистики
- [ ] Оптимизация запросов к БД (select_related, prefetch_related)

## Этап 8: Управление приёмами пищи (Meal)

- [ ] Создание сериализатора для Meal
- [ ] Создание ViewSet для получения приёмов пищи за день
- [ ] Группировка блюд по типам приёмов пищи (завтрак, обед, ужин, перекус)
- [ ] Создание ViewSet для создания нового приёма пищи
- [ ] Валидация типа приёма пищи

## Этап 9: Управление блюдами (Dish)

- [x] Создание сериализатора для Dish
- [x] Создание ViewSet для получения списка блюд
- [ ] Создание ViewSet для получения конкретного блюда
- [ ] Создание ViewSet для редактирования блюда
- [ ] Создание ViewSet для удаления блюда
- [ ] Связывание блюда с приёмом пищи
- [ ] Валидация КБЖУ при создании/редактировании

## Этап 10: Распознавание блюд по фотографии

- [ ] Настройка интеграции с API распознавания изображений (OpenAI Vision API, Google Vision API, или другая)
- [ ] Создание модели DishImage для хранения изображений
- [ ] Настройка загрузки файлов (MEDIA_ROOT, MEDIA_URL)
- [ ] Создание ViewSet для загрузки изображения
- [ ] Создание сервиса для отправки изображения в нейросеть
- [ ] Парсинг ответа от нейросети (название блюда, КБЖУ)
- [ ] Создание блюда на основе распознанных данных
- [ ] Обработка ошибок распознавания
- [ ] Валидация формата и размера изображения

## Этап 11: Система подписок

- [ ] Создание модели тарифов (SubscriptionPlan)
- [ ] Создание сериализатора для Subscription
- [ ] Создание ViewSet для получения информации о текущей подписке
- [ ] Создание логики проверки статуса подписки
- [ ] Создание ViewSet для получения доступных тарифов
- [ ] Настройка ограничений функционала в зависимости от подписки (опционально)

## Этап 12: Система платежей

- [ ] Выбор платежного провайдера (Stripe, PayPal, ЮKassa и др.)
- [ ] Настройка интеграции с платежным провайдером
- [ ] Создание модели Payment
- [ ] Создание сериализатора для Payment
- [ ] Создание ViewSet для создания платежа (месячная подписка)
- [ ] Создание ViewSet для создания платежа (годовая подписка)
- [ ] Создание webhook для обработки уведомлений от платежного провайдера
- [ ] Обновление статуса подписки после успешного платежа
- [ ] Создание ViewSet для получения истории платежей
- [ ] Создание ViewSet для отключения автоматических платежей

## Этап 13: Фильтрация, поиск и пагинация

- [ ] Настройка пагинации для всех списков
- [ ] Добавление фильтрации по дате для блюд
- [ ] Добавление поиска по названию блюд
- [ ] Добавление сортировки результатов

## Этап 14: Обработка ошибок и валидация

- [ ] Создание кастомных исключений
- [ ] Настройка глобального обработчика ошибок
- [ ] Улучшение валидации во всех сериализаторах
- [ ] Добавление понятных сообщений об ошибках
- [ ] Валидация прав доступа (пользователь может редактировать только свои данные)

## Этап 15: Оптимизация и производительность

- [ ] Анализ медленных запросов
- [ ] Добавление индексов в БД для часто используемых полей
- [ ] Оптимизация запросов (select_related, prefetch_related)
- [ ] Кэширование часто запрашиваемых данных (опционально)
- [ ] Оптимизация загрузки изображений

## Этап 16: Документация API

- [ ] Настройка Swagger/OpenAPI (drf-spectacular или drf-yasg)
- [ ] Добавление описаний ко всем эндпоинтам
- [ ] Добавление примеров запросов и ответов
- [ ] Документирование моделей данных
- [ ] Документирование ошибок

## Этап 17: Финальная проверка и доработки

- [ ] Проверка всех эндпоинтов на корректность работы
- [ ] Проверка безопасности (защита от SQL-инъекций, XSS и др.)
- [ ] Проверка обработки граничных случаев
- [ ] Проверка производительности под нагрузкой
- [ ] Рефакторинг кода при необходимости
- [ ] Проверка соответствия требованиям из описания

## Дополнительные улучшения (опционально)

- [ ] Добавление возможности экспорта данных
- [ ] Добавление уведомлений (email/push) о достижении целей
- [ ] Добавление аналитики и графиков (отдельный эндпоинт)
- [ ] Добавление возможности создавать шаблоны блюд
- [ ] Добавление возможности делиться рецептами
- [ ] Добавление базы популярных блюд с готовыми КБЖУ

