# Roadmap разработки REST API для сервиса подсчёта калорий

## Этап 1: Настройка проекта и базовая инфраструктура

- [x] Инициализация Django проекта
- [x] Настройка виртуального окружения
- [x] Установка зависимостей (Django, Django REST Framework, PostgreSQL, и др.)
- [x] Настройка settings.py (база данных, секретные ключи, CORS)
- [x] Создание структуры приложений (apps)
- [x] Настройка urls.py и базовой структуры API
- [x] Настройка логирования

## Этап 2: Модели данных

- [x] Создание модели User (расширение AbstractUser или использование кастомной модели)
- [x] Создание модели Profile (связь с User, дополнительные поля)
- [x] Создание модели Subscription (тарифы, статус подписки)
- [x] Создание модели Payment (история платежей)
- [x] Создание модели DailyGoal (цели КБЖУ на день)
- [x] Создание модели Meal (приём пищи: завтрак, обед, ужин, перекус)
- [x] Создание модели Dish (блюдо с КБЖУ)
- [x] Создание модели DishImage (фотографии блюд для распознавания)
- [x] Настройка связей между моделями (ForeignKey, ManyToMany)
- [x] Создание и применение миграций

## Этап 3: Система аутентификации и авторизации

- [x] Настройка JWT токенов (djangorestframework-simplejwt)
- [x] Создание сериализаторов для регистрации
- [x] Создание сериализаторов для входа (логин)
- [x] Создание ViewSet/APIView для регистрации
- [x] Создание ViewSet/APIView для входа
- [x] Создание ViewSet/APIView для обновления токена
- [x] Создание ViewSet/APIView для выхода
- [x] Настройка permissions для защищённых эндпоинтов
- [x] Тестирование регистрации и входа

## Этап 4: Профиль пользователя

- [x] Создание сериализатора для Profile
- [x] Создание ViewSet для получения профиля
- [x] Создание ViewSet для обновления имени
- [x] Создание ViewSet для обновления email
- [x] Создание ViewSet для смены пароля
- [x] Валидация данных при обновлении
- [x] Обработка ошибок
- [x] Реализация получения профиля (только id, email, first_name)
- [x] Реализация редактирования профиля (только first_name и email)
- [x] Реализация изменения пароля (old_password, new_password)

## Этап 5: Управление целями КБЖУ

- [x] Создание сериализатора для DailyGoal
- [x] Создание ViewSet для получения целей на день
- [x] Создание ViewSet для установки целей вручную
- [x] Создание логики автоматического расчёта КБЖУ (формулы на основе возраста, веса, роста, активности)
- [x] Создание ViewSet для автоматического расчёта целей
- [x] Валидация входных данных для расчёта
- [x] Сохранение истории изменений целей (опционально)

## Этап 6: Управление днями недели

- [x] Создание сериализатора для работы с днями недели
- [x] Создание ViewSet для получения данных по выбранному дню
- [x] Логика фильтрации данных по дате/дню недели
- [x] Обработка перехода между неделями

## Этап 7: Статистика КБЖУ за день

- [x] Создание сериализатора для статистики
- [x] Создание логики агрегации КБЖУ из всех блюд за день
- [x] Расчёт процента выполнения целей
- [x] Создание ViewSet для получения статистики
- [x] Оптимизация запросов к БД (select_related, prefetch_related)

## Этап 8: Управление приёмами пищи (Meal)

- [x] Создание сериализатора для Meal
- [x] Создание ViewSet для получения приёмов пищи за день
- [x] Группировка блюд по типам приёмов пищи (завтрак, обед, ужин, перекус)
- [x] Создание ViewSet для создания нового приёма пищи
- [x] Валидация типа приёма пищи

## Этап 9: Управление блюдами (Dish)

- [x] Создание сериализатора для Dish
- [x] Создание ViewSet для получения списка блюд
- [x] Создание ViewSet для получения конкретного блюда
- [x] Создание ViewSet для редактирования блюда
- [x] Создание ViewSet для удаления блюда
- [x] Связывание блюда с приёмом пищи
- [x] Валидация КБЖУ при создании/редактировании
- [x] Получение блюд пользователя за определенный день

## Этап 10: Распознавание блюд по фотографии

- [x] Настройка интеграции с API распознавания изображений (OpenAI Vision API, Google Vision API, или другая)
- [x] Создание модели DishImage для хранения изображений
- [x] Настройка загрузки файлов (MEDIA_ROOT, MEDIA_URL)
- [x] Создание ViewSet для загрузки изображения
- [x] Создание сервиса для отправки изображения в нейросеть
- [x] Парсинг ответа от нейросети (название блюда, КБЖУ)
- [x] Создание блюда на основе распознанных данных
- [x] Обработка ошибок распознавания
- [x] Валидация формата и размера изображения

## Этап 11: Система подписок

- [x] Создание модели тарифов (SubscriptionPlan)
- [x] Создание сериализатора для Subscription
- [x] Создание ViewSet для получения информации о текущей подписке
- [x] Создание логики проверки статуса подписки
- [x] Создание ViewSet для получения доступных тарифов
- [x] Настройка ограничений функционала в зависимости от подписки (опционально)

## Этап 12: Система платежей

- [x] Выбор платежного провайдера (Stripe, PayPal, ЮKassa и др.)
- [x] Настройка интеграции с платежным провайдером
- [x] Создание модели Payment
- [x] Создание сериализатора для Payment
- [x] Создание ViewSet для создания платежа (месячная подписка)
- [x] Создание ViewSet для создания платежа (годовая подписка)
- [x] Создание webhook для обработки уведомлений от платежного провайдера
- [x] Обновление статуса подписки после успешного платежа
- [x] Создание ViewSet для получения истории платежей
- [x] Создание ViewSet для отключения автоматических платежей

## Этап 13: Фильтрация, поиск и пагинация

- [x] Настройка пагинации для всех списков
- [x] Добавление фильтрации по дате для блюд
- [x] Добавление поиска по названию блюд
- [x] Добавление сортировки результатов

## Этап 14: Обработка ошибок и валидация

- [x] Создание кастомных исключений
- [x] Настройка глобального обработчика ошибок
- [x] Улучшение валидации во всех сериализаторах
- [x] Добавление понятных сообщений об ошибках
- [x] Валидация прав доступа (пользователь может редактировать только свои данные)

## Этап 15: Оптимизация и производительность

- [x] Анализ медленных запросов
- [x] Добавление индексов в БД для часто используемых полей
- [x] Оптимизация запросов (select_related, prefetch_related)
- [x] Кэширование часто запрашиваемых данных (опционально)
- [x] Оптимизация загрузки изображений

## Этап 16: Документация API

- [x] Настройка Swagger/OpenAPI (drf-spectacular или drf-yasg)
- [x] Добавление описаний ко всем эндпоинтам
- [x] Добавление примеров запросов и ответов
- [x] Документирование моделей данных
- [x] Документирование ошибок

## Этап 17: Финальная проверка и доработки

- [x] Проверка всех эндпоинтов на корректность работы
- [x] Проверка безопасности (защита от SQL-инъекций, XSS и др.)
- [x] Проверка обработки граничных случаев
- [x] Проверка производительности под нагрузкой
- [x] Рефакторинг кода при необходимости
- [x] Проверка соответствия требованиям из описания

## Этап 18: Подготовка к деплою

- [x] Создание Dockerfile для контейнеризации
- [x] Создание docker-compose.yml для локальной разработки и production
- [x] Создание .dockerignore для оптимизации образа
- [x] Создание entrypoint.sh для инициализации контейнера
- [x] Настройка Nginx конфигурации
- [x] Создание health check эндпоинтов (/api/health/, /api/ready/, /api/alive/)
- [x] Добавление поддержки PostgreSQL через DATABASE_URL
- [x] Добавление gunicorn для production сервера
- [x] Создание .env.production.example с примерами переменных
- [x] Обновление requirements.txt с production зависимостями
- [x] Создание GitHub Actions workflow для CI/CD
- [x] Настройка линтеров (flake8, black, isort)
- [x] Создание pytest конфигурации
- [x] Создание README.md с инструкциями по установке и запуску
- [x] Создание DEPLOYMENT.md с подробным руководством по деплою
- [x] Создание CHANGELOG.md для истории изменений
- [x] Создание CONTRIBUTING.md для контрибьюторов
- [x] Создание LICENSE файла (MIT)
- [x] Создание SECURITY.md с политикой безопасности
- [x] Создание расширенного TEST_CHECKLIST.md (580 тестов)
- [x] Настройка STATIC_ROOT для collectstatic
- [x] Создание директории logs для логирования

## Этап 19: Комплексное тестирование

- [x] Создание test_auth_comprehensive.py (39 тестов для аутентификации)
- [x] Создание test_profile_comprehensive.py (27 тестов для профиля)
- [x] Создание test_dishes_comprehensive.py (52 теста для блюд)
- [x] Создание test_goals_comprehensive.py (40 тестов для целей КБЖУ)
- [x] Создание test_days_comprehensive.py (18 тестов для управления днями)
- [x] Создание test_subscriptions_comprehensive.py (10 тестов для подписок)
- [x] Создание test_infrastructure.py (30+ тестов инфраструктуры)
- [x] Достижение 70% покрытия кода тестами (143 теста проходят)
- [x] Создание DEPLOYMENT_READINESS_REPORT.md с полным отчётом

## Этап 20: Production деплой

- [x] Создание .env.production с настройками для colories.ru
- [x] Создание скрипта server_setup.sh для установки ПО на сервере
- [x] Создание systemd service файла для gunicorn
- [x] Создание Nginx конфигурации для colories.ru и www.colories.ru
- [x] Создание скрипта deploy.sh для автоматического деплоя
- [x] Создание PRODUCTION_DEPLOY.md с подробной инструкцией
- [x] Создание QUICK_DEPLOY.md для быстрого старта
- [x] Настройка DEBUG=False по умолчанию в settings.py
- [x] Настройка ALLOWED_HOSTS для production доменов
- [x] Настройка DATABASE_URL для PostgreSQL
- [x] Настройка CORS для production доменов
- [x] Настройка Security Headers для HTTPS
- [x] Финальная проверка всего проекта
- [x] Запуск всех тестов (177/177 прошли успешно)
- [x] Проверка линтера (0 ошибок)
- [x] Загрузка в GitHub
- [x] Подготовка к деплою на сервер (сервер готов, ПО установлено)

## Дополнительные улучшения (опционально)

- [ ] Добавление возможности экспорта данных
- [ ] Добавление уведомлений (email/push) о достижении целей
- [ ] Добавление аналитики и графиков (отдельный эндпоинт)
- [ ] Добавление возможности создавать шаблоны блюд
- [ ] Добавление возможности делиться рецептами
- [ ] Добавление базы популярных блюд с готовыми КБЖУ
- [ ] Интеграция с Sentry для мониторинга ошибок
- [ ] Настройка Celery для фоновых задач
- [ ] Добавление Redis для кэширования
- [ ] Kubernetes манифесты для деплоя

