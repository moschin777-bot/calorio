#!/usr/bin/expect -f

set timeout 60

spawn ssh root@217.26.29.106
expect "password:"
send "C&6!wMqm!wOZ\r"
expect "#"

send "cat > /var/www/calorio/.env << 'ENVEOF'\r"
send "SECRET_KEY=django-prod-66e73b287ac31c0dd5b7c43036e4556c5c10239e4367ffe6890e091a0fed206b\r"
send "DEBUG=False\r"
send "ALLOWED_HOSTS=217.26.29.106,colories.ru,www.colories.ru,localhost,127.0.0.1\r"
send "DATABASE_URL=postgresql://calorio_user:calorio_secure_2024@localhost:5432/calorio\r"
send "OPENROUTER_API_KEY=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\r"
send "PAYMENT_WEBHOOK_SECRET=webhook-secure-e1d533487545a9969ffa9d44858ffed2\r"
send "CORS_ALLOWED_ORIGINS=https://colories.ru,https://www.colories.ru,http://colories.ru,http://www.colories.ru,http://217.26.29.106\r"
send "ENVEOF\r"
expect "#"

send "chown calorio:calorio /var/www/calorio/.env\r"
expect "#"

send "systemctl restart calorio\r"
expect "#"

send "sleep 5\r"
expect "#"

send "curl -s http://localhost/api/health/\r"
expect "#"

send "exit\r"
expect eof

