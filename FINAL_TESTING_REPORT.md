# –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ REST API

## –í—ã–ø–æ–ª–Ω–µ–Ω–æ

### ‚úÖ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã pytest, pytest-django, pytest-cov
- –ù–∞—Å—Ç—Ä–æ–µ–Ω pytest.ini
- –°–æ–∑–¥–∞–Ω conftest.py —Å –±–∞–∑–æ–≤—ã–º–∏ —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏
- –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç run_tests.sh –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

### ‚úÖ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

1. **–¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** (`tests/test_auth_comprehensive.py`)
   - 39 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ 1.1-1.4
   - –ü–æ–∫—Ä—ã–≤–∞—é—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é, –≤—Ö–æ–¥, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤, –≤—ã—Ö–æ–¥
   - 9 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
   - 30 —Ç–µ—Å—Ç–æ–≤ —Ç—Ä–µ–±—É—é—Ç –Ω–µ–±–æ–ª—å—à–æ–π –¥–æ—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∏–∫—Å—Ç—É—Ä–∞–º–∏)

2. **–¢–µ—Å—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è** (`tests/test_profile_comprehensive.py`)
   - 27 —Ç–µ—Å—Ç–æ–≤ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ 2.1-2.3
   - –ü–æ–∫—Ä—ã–≤–∞—é—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ —Å–º–µ–Ω—É –ø–∞—Ä–æ–ª—è
   - –¢–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ

3. **–ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã** (`users/tests.py`)
   - –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –Ω–∞ Django TestCase
   - –ü–æ–∫—Ä—ã–≤–∞—é—Ç –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

## –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### üîß –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
–ù—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
- –§–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ø—Ä–æ–±–ª–µ–º–∞ —Å –∏–∑–æ–ª—è—Ü–∏–µ–π —Ç–µ—Å—Ç–æ–≤)
- –û–±—Ä–∞–±–æ—Ç–∫—É –≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤ (–æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–µ email)
- –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–æ–≤ API –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤

### üìù –ù–µ —Å–æ–∑–¥–∞–Ω—ã –ø–æ–∫–∞ (–Ω–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞)

1. **–¢–µ—Å—Ç—ã –±–ª—é–¥** (102 —Ç–µ—Å—Ç–∞) - —Ä–∞–∑–¥–µ–ª 3
2. **–¢–µ—Å—Ç—ã —Ü–µ–ª–µ–π –ö–ë–ñ–£** (54 —Ç–µ—Å—Ç–∞) - —Ä–∞–∑–¥–µ–ª 4
3. **–¢–µ—Å—Ç—ã –¥–Ω–µ–π** (18 —Ç–µ—Å—Ç–æ–≤) - —Ä–∞–∑–¥–µ–ª 5
4. **–¢–µ—Å—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫** (104 —Ç–µ—Å—Ç–∞) - —Ä–∞–∑–¥–µ–ª 6
5. **–û–±—â–∏–µ —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (24 —Ç–µ—Å—Ç–∞) - —Ä–∞–∑–¥–µ–ª 7
6. **–¢–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** (15 —Ç–µ—Å—Ç–æ–≤) - —Ä–∞–∑–¥–µ–ª 8

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–∞—Ö

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
export SECRET_KEY='test-secret-key'
export DEBUG='True'
pytest tests/test_auth_comprehensive.py -v

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã
# –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
# - –§–∏–∫—Å—Ç—É—Ä—ã –Ω–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
# - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç—Ä–µ–±—É—é—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è
```

### 2. –°–æ–∑–¥–∞—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è —Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `tests/test_<module>_comprehensive.py`:

- `tests/test_dishes_comprehensive.py` - —Ç–µ—Å—Ç—ã –¥–ª—è –±–ª—é–¥
- `tests/test_goals_comprehensive.py` - —Ç–µ—Å—Ç—ã –¥–ª—è —Ü–µ–ª–µ–π
- `tests/test_days_comprehensive.py` - —Ç–µ—Å—Ç—ã –¥–ª—è –¥–Ω–µ–π
- `tests/test_subscriptions_comprehensive.py` - —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫
- `tests/test_security_comprehensive.py` - —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `tests/test_config_security.py` - —Ç–µ—Å—Ç—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

–°–æ–≥–ª–∞—Å–Ω–æ —á–µ–∫-–ª–∏—Å—Ç—É, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
- [ ] SECRET_KEY –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] DEBUG=False –≤ production
- [ ] ALLOWED_HOSTS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Security headers –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤–∫–ª—é—á–µ–Ω
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
- [ ] Throttling –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Webhook –ø–æ–¥–ø–∏—Å—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è
- [ ] .env –≤ .gitignore

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```python
@pytest.mark.django_db
class TestModuleName:
    """–û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª—è"""
    
    @pytest.fixture
    def authenticated_client(self, api_client, user):
        """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞"""
        refresh = RefreshToken.for_user(user)
        api_client.credentials(HTTP_AUTHORIZATION=f'Bearer {refresh.access_token}')
        return api_client
    
    def test_scenario_name(self, authenticated_client):
        """–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"""
        # –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–¥
        pass
```

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
export SECRET_KEY='test-secret-key'
export DEBUG='True'
pytest -v

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
pytest tests/test_profile_comprehensive.py -v

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=. --cov-report=html

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_profile_comprehensive.py::TestProfileRetrieve::test_get_profile_authenticated -v
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:**
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø–∞–¥–∞—é—â–∏–µ —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –±–ª—é–¥ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è —Ü–µ–ª–µ–π (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

2. **–ó–∞—Ç–µ–º:**
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –¥–Ω–µ–π
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –ø–æ–¥–ø–∏—Å–æ–∫
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

3. **–í –∫–æ–Ω—Ü–µ:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ 342 —Ç–µ—Å—Ç–∞
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Ç–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∫–∞–∫ —É—Å–ø–µ—à–Ω—ã–µ, —Ç–∞–∫ –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
- –°–ª–µ–¥–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∏–∑ TEST_CHECKLIST.md

## –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤ settings.py
2. ‚ö†Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å .env)
3. ‚úÖ .gitignore —Å–æ–¥–µ—Ä–∂–∏—Ç .env
4. ‚ö†Ô∏è Throttling –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å)
5. ‚ö†Ô∏è Webhook –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å)
6. ‚ö†Ô∏è Security headers (–Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å)

## –ò—Ç–æ–≥

**–í—ã–ø–æ–ª–Ω–µ–Ω–æ:** ~20% –æ—Ç –æ–±—â–µ–≥–æ –æ–±—ä–µ–º–∞ —Ç–µ—Å—Ç–æ–≤  
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ì–æ—Ç–æ–≤–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤  
**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞  

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `tests/conftest.py` - —Ñ–∏–∫—Å—Ç—É—Ä—ã
- `tests/test_auth_comprehensive.py` - —Ç–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏)
- `tests/test_profile_comprehensive.py` - —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è (–≥–æ—Ç–æ–≤—ã)
- `pytest.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
- `TEST_CHECKLIST.md` - –ø–æ–ª–Ω—ã–π —á–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–æ–≤

–î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ –∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å –µ—ë –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –º–æ–¥—É–ª–µ–π.

