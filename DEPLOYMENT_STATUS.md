# –°—Ç–∞—Ç—É—Å –¥–µ–ø–ª–æ—è Calorio API

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –Ω–∞ –æ—à–∏–±–∫–∏
- ‚úÖ System check: 0 –ø—Ä–æ–±–ª–µ–º
- ‚úÖ –õ–∏–Ω—Ç–µ—Ä: 0 –æ—à–∏–±–æ–∫
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏: –≤—Å–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –ó–∞–ø—É—â–µ–Ω—ã –≤—Å–µ —Ç–µ—Å—Ç—ã: **177 —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ**
- ‚úÖ –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞: **86%** (—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 80%)
- ‚úÖ –¢–µ—Å—Ç—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: 39/39 ‚úÖ
- ‚úÖ –¢–µ—Å—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è: 27/27 ‚úÖ
- ‚úÖ –¢–µ—Å—Ç—ã –±–ª—é–¥: 52/52 ‚úÖ
- ‚úÖ –¢–µ—Å—Ç—ã —Ü–µ–ª–µ–π –ö–ë–ñ–£: 40/40 ‚úÖ
- ‚úÖ –¢–µ—Å—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–Ω—è–º–∏: 18/18 ‚úÖ
- ‚úÖ –¢–µ—Å—Ç—ã –ø–æ–¥–ø–∏—Å–æ–∫: 10/10 ‚úÖ
- ‚úÖ –¢–µ—Å—Ç—ã –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã: 30/30 ‚úÖ

### 3. Git
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ git
- ‚úÖ –ö–æ–º–º–∏—Ç —Å–æ–∑–¥–∞–Ω —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ GitHub (origin/main)

### 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –¥–µ–ø–ª–æ—é
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã –¥–µ–ø–ª–æ—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã systemd service –∏ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üìã –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –¥–µ–ø–ª–æ—é

–ü—Ä–æ–µ–∫—Ç **–ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤** –∫ –¥–µ–ø–ª–æ—é –Ω–∞ production —Å–µ—Ä–≤–µ—Ä.

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ
- **IP**: 217.26.29.106
- **–î–æ–º–µ–Ω—ã**: colories.ru, www.colories.ru
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: root
- **–ü–∞—Ä–æ–ª—å**: C&6!wMqm!wOZ

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@217.26.29.106
# –ü–∞—Ä–æ–ª—å: C&6!wMqm!wOZ

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –¥–µ–ø–ª–æ—è
curl -sSL https://raw.githubusercontent.com/moschin777-bot/calorio/main/scripts/server_setup.sh | bash
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π

–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ñ–∞–π–ª–µ `PRODUCTION_DEPLOY.md`

–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏:

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ü–û**
```bash
apt update && apt upgrade -y
apt install -y python3.11 python3.11-venv python3.11-dev git nginx postgresql postgresql-contrib
```

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL**
```bash
sudo -u postgres psql
CREATE DATABASE calorio;
CREATE USER calorio_user WITH PASSWORD 'secure_password';
GRANT ALL PRIVILEGES ON DATABASE calorio TO calorio_user;
\q
```

3. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞**
```bash
useradd -m -s /bin/bash calorio
mkdir -p /var/www/calorio
chown calorio:calorio /var/www/calorio
sudo su - calorio
cd /var/www/calorio
git clone https://github.com/moschin777-bot/calorio.git .
```

4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

5. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env**
```bash
cp .env.production .env
nano .env  # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```

6. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
```bash
python manage.py migrate
python manage.py createsuperuser
python manage.py collectstatic --noinput
exit
```

7. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd**
```bash
cp /var/www/calorio/scripts/calorio.service /etc/systemd/system/
systemctl daemon-reload
systemctl enable calorio
systemctl start calorio
```

8. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx**
```bash
cp /var/www/calorio/scripts/nginx_calorio.conf /etc/nginx/sites-available/calorio
ln -sf /etc/nginx/sites-available/calorio /etc/nginx/sites-enabled/calorio
rm -f /etc/nginx/sites-enabled/default
nginx -t
systemctl restart nginx
```

9. **–ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞**
```bash
apt install -y certbot python3-certbot-nginx
certbot --nginx -d colories.ru -d www.colories.ru
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# Health check
curl http://217.26.29.106/api/health/
curl http://colories.ru/api/health/

# API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
curl http://colories.ru/api/docs/

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://colories.ru/api/auth/register/ \
  -H "Content-Type: application/json" \
  -d '{"first_name":"Test","email":"test@example.com","password":"testpass123"}'
```

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

- **–í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤**: ~50
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~2400
- **–¢–µ—Å—Ç–æ–≤**: 177
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 86%
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ API**: 25+
- **–ú–æ–¥–µ–ª–µ–π**: 9
- **–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤**: 15+

## üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```bash
# –õ–æ–≥–∏ Gunicorn
journalctl -u calorio -f
tail -f /var/www/calorio/logs/gunicorn-error.log

# –õ–æ–≥–∏ Nginx
tail -f /var/log/nginx/error.log

# –õ–æ–≥–∏ Django
tail -f /var/www/calorio/logs/django.log
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
systemctl restart calorio
systemctl restart nginx
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
```bash
sudo su - calorio
cd /var/www/calorio
git pull origin main
source venv/bin/activate
pip install -r requirements.txt
python manage.py migrate
python manage.py collectstatic --noinput
exit
systemctl restart calorio
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é
2. ‚è≥ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–ø–ª–æ—è
3. ‚è≥ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ API
4. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
5. ‚è≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –±—ç–∫–∞–ø–æ–≤

## üéØ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API –ø–æ –∞–¥—Ä–µ—Å—É:
- **HTTP**: http://colories.ru/api/
- **HTTPS**: https://colories.ru/api/ (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSL)

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
- **Swagger UI**: https://colories.ru/api/docs/
- **ReDoc**: https://colories.ru/api/redoc/

